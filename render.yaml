# Configuração do Render para deploy automático
# Este arquivo configura 3 serviços no free tier:
# 1. Web Service (API HTTP)
# 2. Background Worker (processamento sem timeout)
# 3. Redis (fila de jobs)

services:
  # API HTTP - Recebe uploads e consulta status
  - type: web
    name: screenshot-api
    runtime: python
    plan: free
    rootDir: backend
    buildCommand: |
      pip install -r requirements.txt
      pip install -r ../requirements.txt
      python -m playwright install chromium
      python -m playwright install-deps
    startCommand: uvicorn api:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: REDIS_URL
        fromDatabase:
          name: screenshot-redis
          property: connectionString
      - key: PYTHON_VERSION
        value: 3.12.0
    healthCheckPath: /

  # Background Worker - Processa screenshots sem timeout
  - type: worker
    name: screenshot-worker
    runtime: python
    plan: free
    rootDir: backend
    buildCommand: |
      pip install -r requirements.txt
      pip install -r ../requirements.txt
      python -m playwright install chromium
      python -m playwright install-deps
    startCommand: python worker.py
    envVars:
      - key: REDIS_URL
        fromDatabase:
          name: screenshot-redis
          property: connectionString
      - key: PYTHON_VERSION
        value: 3.12.0

# Redis database para fila de jobs
databases:
  - name: screenshot-redis
    plan: free
    ipAllowList: []
